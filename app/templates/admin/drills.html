{% extends "admin/layout.html" %}

{% block title %}Drills | Admin{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">Drills</h1>
    <button onclick="document.getElementById('createDrillModal').classList.remove('hidden')" class="admin-button admin-button-success">Create Drill</button>
  </div>
  {% if error_message %}
    <div class="mb-4 p-3 bg-red-100 text-red-700 rounded">{{ error_message }}</div>
  {% endif %}
  {% if success_message %}
    <div class="mb-4 p-3 bg-green-100 text-green-700 rounded">{{ success_message }}</div>
  {% endif %}
  <div class="overflow-x-auto bg-white rounded shadow">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">ID</th>
          <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Name</th>
          <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Type</th>
          <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Difficulty</th>
          <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Duration</th>
          <th class="px-4 py-2 text-left text-xs font-semibold text-gray-600">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for drill in drills %}
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-2">{{ drill.id }}</td>
          <td class="px-4 py-2">{{ drill.name }}</td>
          <td class="px-4 py-2">{{ drill.drill_type }}</td>
          <td class="px-4 py-2">{{ drill.difficulty }}</td>
          <td class="px-4 py-2">{{ drill.duration_minutes }} min</td>
          <td class="px-4 py-2 flex gap-2">
            <button onclick="showEditDrillModal({{ drill.id }}, '{{ drill.name|escape }}', '{{ drill.drill_type|escape }}', '{{ drill.difficulty|escape }}', {{ drill.duration_minutes }}, '{{ drill.description|escape }}')" class="admin-button admin-button-primary">Edit</button>
            <form method="post" action="/admin/drills/{{ drill.id }}?_method=DELETE" onsubmit="return confirm('Delete this drill?')">
              <button type="submit" class="admin-button admin-button-danger">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center py-8 text-gray-400">No drills found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Create Drill Modal -->
<div id="createDrillModal" class="fixed inset-0 bg-gray-500 bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg p-6 w-full max-w-md">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-bold">Create Drill</h2>
      <button onclick="document.getElementById('createDrillModal').classList.add('hidden')" class="text-gray-400">&times;</button>
    </div>
    <form method="post" action="/admin/drills">
      <div class="mb-3">
        <label class="block text-sm font-medium">Name</label>
        <input name="name" required class="w-full border rounded px-2 py-1" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Type</label>
        <select name="drill_type" required class="w-full border rounded px-2 py-1">
          <option value="DRAW">Draw</option>
          <option value="DRIVE">Drive</option>
          <option value="WEIGHT_CONTROL">Weight Control</option>
          <option value="POSITION">Position</option>
          <option value="MIXED">Mixed</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Difficulty</label>
        <select name="difficulty" required class="w-full border rounded px-2 py-1">
          <option value="BEGINNER">Beginner</option>
          <option value="INTERMEDIATE">Intermediate</option>
          <option value="ADVANCED">Advanced</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Duration (minutes)</label>
        <input name="duration_minutes" type="number" min="5" max="120" value="30" required class="w-full border rounded px-2 py-1" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Description</label>
        <textarea name="description" required class="w-full border rounded px-2 py-1"></textarea>
      </div>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('createDrillModal').classList.add('hidden')" class="admin-button bg-gray-200 text-gray-700">Cancel</button>
        <button type="submit" class="admin-button admin-button-success">Create</button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Drill Modal (populated by JS) -->
<div id="editDrillModal" class="fixed inset-0 bg-gray-500 bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg p-6 w-full max-w-md">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-lg font-bold">Edit Drill</h2>
      <button onclick="document.getElementById('editDrillModal').classList.add('hidden')" class="text-gray-400">&times;</button>
    </div>
    <form id="editDrillForm" method="post">
      <div class="mb-3">
        <label class="block text-sm font-medium">Name</label>
        <input name="name" id="edit_name" required class="w-full border rounded px-2 py-1" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Type</label>
        <select name="drill_type" id="edit_drill_type" required class="w-full border rounded px-2 py-1">
          <option value="DRAW">Draw</option>
          <option value="DRIVE">Drive</option>
          <option value="WEIGHT_CONTROL">Weight Control</option>
          <option value="POSITION">Position</option>
          <option value="MIXED">Mixed</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Difficulty</label>
        <select name="difficulty" id="edit_difficulty" required class="w-full border rounded px-2 py-1">
          <option value="BEGINNER">Beginner</option>
          <option value="INTERMEDIATE">Intermediate</option>
          <option value="ADVANCED">Advanced</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Duration (minutes)</label>
        <input name="duration_minutes" id="edit_duration_minutes" type="number" min="5" max="120" required class="w-full border rounded px-2 py-1" />
      </div>
      <div class="mb-3">
        <label class="block text-sm font-medium">Description</label>
        <textarea name="description" id="edit_description" required class="w-full border rounded px-2 py-1"></textarea>
      </div>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="document.getElementById('editDrillModal').classList.add('hidden')" class="admin-button bg-gray-200 text-gray-700">Cancel</button>
        <button type="submit" class="admin-button admin-button-primary">Update</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showEditDrillModal(id, name, type, difficulty, duration, description) {
  const modal = document.getElementById('editDrillModal');
  const form = document.getElementById('editDrillForm');
  form.action = `/admin/drills/${id}?_method=PUT`;
  document.getElementById('edit_name').value = name;
  document.getElementById('edit_drill_type').value = type;
  document.getElementById('edit_difficulty').value = difficulty;
  document.getElementById('edit_duration_minutes').value = duration;
  document.getElementById('edit_description').value = description;
  modal.classList.remove('hidden');
}
</script>
{% endblock %}
